<?xml version="1.0"?>
<project name="flexunit-tasks" >
	
	<property name="FLEXUNIT_LIB_LOCATION" location="${libs.dir}/flexunit" />
	<property name="FLEXUNIT_LOCALE_LOCATION" location="${libs.dir}/flexunit/locale" />
	
	<property name="reports.dir" value="${basedir}/reports/"/>
	<property name="flexunit.port" value="1024" />
	<property name="testHarness.name" value="${ant.project.name}"/>
	
	<taskdef resource="flexUnitTasks.tasks" classpath="${FLEXUNIT_LIB_LOCATION}/flexUnitTasks-4.1.0-8.jar" />
	
	<import file="flex-common-tasks.xml" />
	
	<macrodef name="run-flexunit">
		<attribute name="first.extra.libs.dir" default="" />
		<sequential>
			<delete dir="${reports.dir}/flexunit" failonerror="false" />
			<mkdir dir="${reports.dir}/flexunit" />
			<check-if-uptodate inputFile="bin/TestRunner.swf" outputproperty="testharness.uptodate" />
			<mkdir dir="bin" />
			<if><not><isset property="testharness.uptodate" /></not><then>
				<flexunit 
					port="${flexunit.port}"
					workingDir="bin"
					toDir="${reports.dir}/flexunit" 
					haltonfailure="true" 
					verbose="true"
					timeout="10000"
					localTrusted="true"
					failureproperty="flexunit.failed">
					<source dir="src" />
					<testSource dir="test">
						<include name="**/*Test.as" />
					</testSource>
					<library dir="libs" />
					<library dir="@{first.extra.libs.dir}" />
				</flexunit>
			</then></if>
		</sequential>
	</macrodef>
	
	<!-- ================================= 
		  target: test			  
		 ================================= -->
	<target name="test" description="Runs the flexunit tests">
		<run-flexunit />
	</target>
	
	<target name="test-clean" description="Cleans the test artifacts">
		<delete file="bin/TestRunner.mxml" />
		<delete file="bin/TestRunner.swf" />
		<delete dir="${reports.dir}/flexunit" failonerror="false" />
	</target>
	
</project>