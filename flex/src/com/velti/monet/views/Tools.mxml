<?xml version="1.0" encoding="utf-8"?>
<controls:CollapsiblePanel xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:controls="com.velti.monet.controls.*"
	xmlns:components="com.velti.monet.views.components.*"
	horizontalAlign="center" layout="vertical" paddingBottom="10" title="TOOLS" verticalGap="10">
	
	<mx:HBox width="100%" paddingTop="10">
		<mx:VBox width="33%" horizontalAlign="center" verticalAlign="middle" verticalGap="3">
			<components:NonDeselectableButton id="handToolButton" width="26"
				change="toolButton_changeHandler(event)" icon="{Cursors.HAND}"
				selected="{presentationModel.interactionMode == InteractionMode.MOVE}" toggle="true"/>
			<mx:Label fontSize="9" text="Hand Tool"/>
		</mx:VBox>
		<mx:VBox width="33%" horizontalAlign="center" verticalAlign="middle" verticalGap="3">
			<components:NonDeselectableButton id="selectToolButton" width="26"
				change="toolButton_changeHandler(event)" icon="{Cursors.SELECT}"
				selected="{presentationModel.interactionMode == InteractionMode.SELECT}"
				toggle="true"/>
			<mx:Label fontSize="9" text="Select Tool"/>
		</mx:VBox>
		<mx:VBox width="33%" horizontalAlign="center" verticalAlign="middle" verticalGap="3">
			<components:NonDeselectableButton id="magicWandToolButton" width="26"
				change="toolButton_changeHandler(event)" icon="{Cursors.MAGIC_WAND}"
				selected="{presentationModel.interactionMode == InteractionMode.MAGIC}"
				toggle="true"/>
			<mx:Label fontSize="9" text="Magic Wand"/>
		</mx:VBox>
	</mx:HBox>
	
	<mx:HRule width="100%"/>
	
	<mx:Button id="pivotButton"
		label="{pivotButton.selected ? resourceManager.getString('UI','unpivot') : resourceManager.getString('UI','pivot')}"
		change="pivotButton_changeHandler(event)"
		enabled="{presentationModel.selectedElements.length == 1}" toggle="true"/>
	
	<mx:Button id="traceButton"
			   toggle="true"
			   label="{traceButton.selected ? resourceManager.getString('UI','untrace') : resourceManager.getString('UI','trace')}"
			   change="traceButton_changeHandler(event)"
			   enabled="{presentationModel.selectedElements.length == 1}"/>
	
	<mx:Script>
		<![CDATA[
			import com.velti.monet.events.InteractionModeEvent;
			import com.velti.monet.events.PlanEvent;
			import com.velti.monet.models.Element;
			import com.velti.monet.models.InteractionMode;
			import com.velti.monet.models.PresentationModel;
		
			import mx.controls.Alert;
			import mx.managers.CursorManager;
		
			/**
			 * Handle to the global presentation model.
			 */
			[Inject] [Bindable]
			public var presentationModel:PresentationModel;
			
			/**
			 * Swiz injected dispatcher.
			 */
			[Dispatcher]
			public var dispatcher:IEventDispatcher;
			
			/**
			 * Handles the user clicking to change the state of the pivot button
			 * to either turn pivoting on or off.
			 */
			protected function pivotButton_changeHandler(event:Event):void {
				trace( "pivot button selected: " + pivotButton.selected );
				traceButton.selected = false;
				if( pivotButton.selected ){
					dispatcher.dispatchEvent( new PlanEvent( PlanEvent.PIVOT, presentationModel.selectedElements.getItemAt( 0 ) as Element ) );                    
				}else{
					dispatcher.dispatchEvent( new PlanEvent( PlanEvent.UNPIVOT ) );
				}
			}
			
			/**
			 * Handles the user clicking to change the state of the pivot button
			 * to either turn pivoting on or off.
			 */
			protected function traceButton_changeHandler(event:Event):void {
				trace( "trace button selected: " + pivotButton.selected );
				pivotButton.selected = false;
				if( traceButton.selected ){
					dispatcher.dispatchEvent( new PlanEvent( PlanEvent.TRACE, presentationModel.selectedElements.getItemAt( 0 ) as Element ) );
				}else{
					dispatcher.dispatchEvent( new PlanEvent( PlanEvent.UNTRACE ) );
				}
			}
			
			/**
			 * Handles the user clicking one of the mouse tool buttons
			 * to change the interaction mode of the application.
			 */
			protected function toolButton_changeHandler(event:Event):void {
				var interactionMode:InteractionMode;
				switch( event.target ){
					case handToolButton:
						interactionMode = InteractionMode.MOVE;
						break;
					case selectToolButton:
						interactionMode = InteractionMode.SELECT;
						break;
					case magicWandToolButton:
						interactionMode = InteractionMode.MAGIC;
						break;
				}
				dispatcher.dispatchEvent( new InteractionModeEvent( InteractionModeEvent.CHANGE, interactionMode ) );
				event.preventDefault();
				event.stopImmediatePropagation();
			}
		
		]]>
	</mx:Script>
</controls:CollapsiblePanel>
